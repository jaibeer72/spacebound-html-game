for(var canvas,ctx,LEND_X,LEND_Y,inputStates={},player={x:250,y:625,w:50,h:50,vx:5,vy:5},DVr=3,gameState=0,MaxDrawDistLine=350,Planet={active:!1,x:50,y:-200,d:123,vy:1,vx:1,R_Min:{x:0,y:0},R_Max:{x:400,y:184},sp:{rad:58,x:0,y:0}},no=3,PlanetArr=[],SmallerArr=new Array(4),i=0;i<10;i++)SmallerArr[i]=new Array(4);var imageObj,j=0,AIplanet={x:50,y:-200,d:45,vy:1,vx:5},AIArr=[],distanceTraveled=0,link=document.createElement("link");function mouseEventManager(t){var a=canvas.getBoundingClientRect(),e=document.documentElement;return{x:t.clientX-a.left-e.scrollLeft,y:t.clientY-a.top-e.scrollTop}}function GameLoop(){var t=new BGRain;switch(t.move(),t.draw(),ctx.globalCompositeOperation="source-over",ctx.fillStyle="rgba(0, 0, 0, 0.3)",ctx.fillRect(0,0,canvas.width,canvas.height),gameState){case 0:distanceTraveled=0,ctx.fillStyle="white",ctx.font="50px Fascinate Inline",ctx.textBaseline="top",ctx.fillText("Spacebound",20,10),ctx.font="40px Fascinate Inline",ctx.fillText("MainMenu",20,100),ctx.font="25px Open Sans Condensed",ctx.fillText("Press SPACE to start",20,200),ctx.fillText("click and hold to move planets",20,250),ctx.fillText("and move avoid the wormhole",20,300),ctx.fillStyle="#f68e56",ctx.beginPath(),ctx.arc(375,250,Planet.d/2,0,2*Math.PI,!0),ctx.fill(),ctx.fillText("use their gravity to roam ",290,325),ctx.fillText("throgh space ",325,350);var a=AIrandomeColor(),e=ctx.createRadialGradient(380,420,0,380,420,AIplanet.d/2);e.addColorStop(0,"white"),e.addColorStop(.4,"white"),e.addColorStop(.4,a),e.addColorStop(1,"black"),ctx.fillStyle=e,ctx.beginPath(),ctx.arc(380,420,AIplanet.d/2,0,2*Math.PI,!0),ctx.fill(),ctx.fillStyle=a,ctx.fillText("avoid At all costs",290,425),!0===inputStates.space&&(gameState=1,ClearBG());break;case 1:for(var r=0;r<no;r++){var n=PlanetArr[r],l=AIArr[r];l.move(),l.colision(),n.move(),inputStates.mousedown&&n.colision(),n.MovePlayerWithPlanet(),n.draw(),l.draw();for(var i=0;i<4;i++){SmallerArr[r][i].drawSML()}}DrawPath(LEND_X,LEND_Y),Draw_Player(player.x,player.y),displayScore();break;case 2:ctx.fillRect(0,0,canvas.width,canvas.height),ctx.fillStyle="white",ctx.font="50px Fascinate Inline",ctx.textBaseline="top",ctx.fillText("Spacebound",20,10),ctx.font="40px Fascinate Inline",ctx.fillStyle="red",ctx.fillText("GAMEOVER!",20,100),ctx.fillStyle="white",ctx.font="25px Open Sans Condensed",ctx.fillText("Press SPACE to re-start",20,200),ctx.fillText("use mouse to target planets",20,250),ctx.fillText("and move avoid the Astroids",20,300),ctx.fillStyle="Green",ctx.fillText("Your Score",20,350),ctx.fillText(distanceTraveled,50,400),1==inputStates.space&&(createPlanet(3),createAI(3),player.x=250,player.y=625,distanceTraveled=0,gameState=1);break;default:console.log("Error MainLoop")}}function Draw_Player(t,a){var e=LEND_X-(player.x+player.w/2),r=LEND_Y-(player.y+player.h/2),n=Math.atan2(r,e);ctx.save(),ctx.translate(player.x,player.y),ctx.rotate(n+90*Math.PI/180),ctx.drawImage(imageObj,0,0,50,50,-player.w/2,-player.h/2,player.w,player.h),ctx.restore(),console.log("Is drawing")}function movePlayer(t,a){var e=t-(player.x+player.w/2),r=a-(player.y+player.h/2),n=Math.atan2(r,e);player.vx=5*Math.cos(n),player.vy=5*Math.sin(n),player.x+=player.vx,player.y+=player.vy,distanceTraveled+=player.y,(player.x>canvas.width||player.x<0||player.y>canvas.height||player.y<0)&&(gameState=2),Math.floor(distanceTraveled)}function createPlanet(t){for(var a=0;a<t;a++){var e=RandSign(),r=planetRandomizer(),n=new updatePlanet(r,Planet.y+a*Planet.d*2.3,Planet.vx,Planet.vy,Planet.d,e.x,e.y);PlanetArr[a]=n;for(var l=0;l<4;l++){var i=RandInArea(r,Planet.y+a*Planet.d*2.3,Planet.d/2),o=new DrawSmallerPlanet(i.x,i.y,i.r);SmallerArr[a][l]=o}}}function RandSign(){switch(Math.floor(8*Math.random())){case 0:return{x:+DVr,y:+DVr};case 1:return{x:-DVr,y:-DVr};case 2:return{x:+DVr,y:-DVr};case 3:return{x:-DVr,y:+DVr};case 4:return{x:+DVr,y:0};case 5:return{x:-DVr,y:0};case 6:return{x:0,y:+DVr};case 7:return{x:0,y:-DVr};default:console.log("error in Case Switch 251")}}function RandInArea(t,a,e){var r=t-e,n=a-e,l=t+e,i=a+e;return{x:Math.floor(Math.random()*(l-r)+r),y:Math.floor(Math.random()*(i-n)+n),r:Math.floor(10.5*Math.random()+7.5)}}function updatePlanet(t,a,e,r,n,l,i){this.x=t,this.y=a,this.vx=e,this.vy=r,this.rad=n/2,this.active=!0,this.sx=l,this.sy=i,this.draw=function(){ctx.fillStyle="#f68e56",ctx.beginPath(),ctx.arc(this.x,this.y,this.rad,0,2*Math.PI,!0),ctx.fill(),ctx.fillStyle="#d33737",ctx.beginPath(),ctx.arc(this.x+this.sx,this.y+this.sy,Planet.sp.rad,0,2*Math.PI,!0),ctx.fill();for(var t=0;t<4;t++){var a=RandInArea(this.x,this.y,this.d/2);ctx.fillStyle="#f68e56",ctx.beginPath(),ctx.arc(a.x,a.y,a.r,0,2*Math.PI,!0),ctx.fill()}},this.move=function(){if(this.y>canvas.height+2.3*Planet.d){var t=RandSign(),a=planetRandomizer(),e=RandInArea(a,Planet.y,Planet.d/2);for(PlanetArr[2]=PlanetArr[1],PlanetArr[1]=PlanetArr[0],PlanetArr[0]=new updatePlanet(a,Planet.y+2*Planet.d,Planet.vx,Planet.vy,Planet.d,t.x,t.y),this.y+=this.vy,this.yy+=this.vy,j=0;j<4;j++)SmallerArr[2][j]=SmallerArr[1][j],SmallerArr[1][j]=SmallerArr[0][j],SmallerArr[0][j]=new DrawSmallerPlanet(e.x,e.y,e.r)}else this.y+=this.vy,this.yy+=this.vy},this.colision=function(){var t=MathClampToR(LEND_X,LEND_Y),a=this.x-t.x,e=this.y-t.y;a*a+e*e<this.rad*this.rad&&movePlayer(t.x,t.y)},this.MovePlayerWithPlanet=function(){var t=this.x-player.x,a=this.y-player.y;t*t+a*a<this.rad*this.rad&&(player.y+=Planet.vy)}}function DrawSmallerPlanet(t,a,e){this.xx=t,this.yy=a,this.rr=e,this.drawSML=function(){ctx.fillStyle="#f68e56",ctx.beginPath(),ctx.arc(this.xx,this.yy,this.rr,0,2*Math.PI,!0),ctx.fill(),this.yy+=Planet.vy},this.move=function(){this.yy+=Planet.vy}}function planetRandomizer(){return Math.random()*(500-Planet.d-Planet.d)+Planet.d}function DrawPath(t,a){var e=MathClampToR(t,a);ctx.strokeStyle="white",ctx.beginPath(),ctx.setLineDash([5,15]),ctx.moveTo(player.x,player.y),ctx.lineTo(e.x,e.y),ctx.stroke()}function updateAI(t,a,e,r,n){this.x=t,this.y=a,this.vx=e,this.vy=r,this.rad=n/2,this.active=!0,this.draw=function(){var t=AIrandomeColor(),a=ctx.createRadialGradient(this.x,this.y,0,this.x,this.y,this.rad);a.addColorStop(0,"white"),a.addColorStop(.4,"white"),a.addColorStop(.4,t),a.addColorStop(1,"black"),ctx.fillStyle=a,ctx.beginPath(),ctx.arc(this.x,this.y,this.rad,0,2*Math.PI,!0),ctx.fill()},this.move=function(){this.y>canvas.height+2.3*Planet.d&&(AIArr[2]=AIArr[1],AIArr[1]=AIArr[0],AIArr[0]=new updateAI(planetRandomizer(),AIplanet.y+2.5*AIplanet.d,AIplanet.vx,AIplanet.vy,AIplanet.d)),this.y+=this.vy},this.colision=function(){var t=this.x-player.x,a=this.y-player.y;t*t+a*a<this.rad+player.w*this.rad+player.w&&(gameState=2)}}function AIrandomeColor(){return"rgb("+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+")"}function createAI(t){for(var a=0;a<t;a++){var e=new updateAI(planetRandomizer(),AIplanet.y+a*AIplanet.d*5,AIplanet.vx,AIplanet.vy,AIplanet.d);AIArr[a]=e}}function MathClampToR(t,a){var e=t-(player.x+player.w/2),r=a-(player.y+player.h/2);if(e*e+r*r<MaxDrawDistLine*MaxDrawDistLine)return{x:t,y:a};var n=Math.atan2(r,e);return{x:player.x+MaxDrawDistLine*Math.cos(n),y:player.y+MaxDrawDistLine*Math.sin(n)}}function EventListeners(){canvas.addEventListener("mousemove",function(t){var a=mouseEventManager(t);LEND_X=a.x,LEND_Y=a.y}),canvas.addEventListener("mousedown",function(t){inputStates.mousedown=!0,inputStates.mouseButton=t.button},!1),canvas.addEventListener("mouseup",function(t){inputStates.mousedown=!1},!1),window.addEventListener("keydown",function(t){32===t.keyCode&&(inputStates.space=!0)},!1),window.addEventListener("keyup",function(t){32===t.keyCode&&(inputStates.space=!1)},!1)}function displayScore(){ctx.save(),ctx.fillStyle="Green",Math.floor(distanceTraveled),ctx.fillText("traveled: "+distanceTraveled,canvas.width-200,30),ctx.restore()}function BGRain(){var t=AIrandomeColor();ctx.strokeStyle=t,ctx.lineWidth=1,ctx.lineCap="round";for(var a=[],e=0;e<500;e++)a.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,l:1*Math.random(),xs:.5*Math.random()-.5+.5,ys:1*Math.random()+1});for(var r=[],n=0;n<500;n++)r[n]=a[n];this.draw=function(){for(var t=0;t<r.length;t++){var a=r[t];ctx.beginPath(),ctx.moveTo(a.x,a.y),ctx.lineTo(a.x+a.l*a.xs,a.y+a.l*a.ys),ctx.stroke()}},this.move=function(){for(var t=0;t<r.length;t++){var a=r[t];a.x+=.5*a.xs,a.y+=.5*a.ys,(a.x>canvas.width||a.y>canvas.height)&&(a.x=Math.random()*canvas.width,a.y=-20)}}}link.rel="stylesheet",link.type="text/css",link.href='https://fonts.googleapis.com/css?family=Fascinate+Inline|Open+Sans+Condensed:300"',document.getElementsByTagName("head")[0].appendChild(link),window.onload=function(){canvas=document.querySelector("canvas"),ctx=canvas.getContext("2d"),imageObj=document.getElementById("r"),createPlanet(3),createAI(3),setInterval(function(){GameLoop(),EventListeners()},1e3/60)};